<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Premium Silicone Case ‚Äì Smart Farmer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Buy Anker Soundcore R50i NC premium silicone case. Fast delivery, COD, 7‚Äëday returns. Read ratings & reviews and checkout securely." />
    <meta property="og:title" content="Premium Silicone Case ‚Äì Smart Farmer" />
    <meta property="og:description" content="Fast delivery, COD, 7‚Äëday returns. Read ratings & reviews and checkout securely." />
    <meta property="og:type" content="product" />

    <style>
      :root {
        --bg: #f4f6f8;
        --fg: #111;
        --muted: #666;
        --card: #fff;
        --brand: #2563eb;
        --accent: #16a34a;
        --danger: #dc2626;
        --warn: #f59e0b;
        --border: #e5e7eb;
        --focus: #3b82f6;
      }
      * { box-sizing: border-box; }
      html:focus-within { scroll-behavior: smooth; }
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; background: var(--bg); color: var(--fg); }
      .visually-hidden{ position:absolute !important; height:1px; width:1px; overflow:hidden; clip:rect(1px,1px,1px,1px); white-space:nowrap; }
      :focus-visible { outline: 3px solid var(--focus); outline-offset: 2px; border-radius: 6px; }
      @media (prefers-reduced-motion: reduce){ *{animation:none!important;transition:none!important;scroll-behavior:auto!important;} }

      /* Header */
      header { position: sticky; top: 0; background: #fff; border-bottom: 1px solid var(--border); padding: 12px 20px; display: flex; gap: 16px; align-items: center; z-index: 5; }
      .brand { font-weight: 700; color: var(--brand); }
      .header-right { margin-left: auto; display: flex; gap: 8px; align-items: center; }
      .search { display: flex; gap: 6px; align-items: center; }
      .search input { width: min(60vw, 480px); padding: 8px 10px; border: 1px solid var(--border); border-radius: 6px; }
      .icon-btn { border: 1px solid var(--border); background: #fff; padding: 8px 12px; border-radius: 8px; cursor: pointer; }
      .icon-btn.badge { position: relative; }
      .badge span { position: absolute; top: -6px; right: -6px; background: var(--danger); color: #fff; border-radius: 999px; padding: 2px 6px; font-size: 12px; line-height: 1; }

      /* Main two-column */
      .container { display: flex; flex-wrap: wrap; gap: 20px; padding: 20px; }
      .left-section, .right-section { background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 16px; min-width: 300px; flex: 1; }

      /* Gallery */
      .main-image { width: 100%; max-width: 480px; aspect-ratio: 1/1; object-fit: contain; background: #fafafa; border: 1px solid var(--border); border-radius: 8px; margin: 0 auto 10px; display: block; }
      .thumbnails { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; }
      .thumbnails img { width: 64px; height: 64px; object-fit: cover; border: 1px solid var(--border); border-radius: 6px; cursor: pointer; transition: box-shadow 0.2s; }
      .thumbnails img.active { outline: 2px solid var(--brand); }

      /* Product info */
      h1,h2 { margin: 0 0 6px; }
      .meta { color: var(--muted); font-size: 14px; }
      .price-box { margin: 10px 0; font-size: 18px; display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
      .price-now { color: var(--danger); font-weight: 700; font-size: 22px; }
      .old-price { text-decoration: line-through; color: var(--muted); }
      .discount { color: var(--accent); font-weight: 600; }
      .row { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; margin: 8px 0; }
      .qty input { width: 56px; text-align: center; padding: 6px; border: 1px solid var(--border); border-radius: 6px; }
      .btn { padding: 10px 14px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; }
      .btn.primary { background: var(--brand); color: #fff; }
      .btn.secondary { background: #111827; color: #fff; }
      .pill { display:inline-flex; gap:6px; align-items:center; border:1px solid var(--border); background:#f8fafc; padding:6px 10px; border-radius:999px; font-size:12px; }
      /* Delta color pills */
.delta-good { background:#ecfdf5; border-color:#bbf7d0; color:#166534; }
.delta-bad  { background:#fef2f2; border-color:#fecaca; color:#991b1b; }

      .info-block, .seller-info, .related-products, .reviews { background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 16px; margin: 20px; }
      .info-line { margin: 4px 0; }

      /* Reviews */
      .rating-head { display: flex; align-items: center; gap: 16px; flex-wrap: wrap; }
      .avg-badge { font-size: 32px; font-weight: 800; }
      .rating-breakdown { display: flex; gap: 10px; flex-wrap: wrap; font-size: 14px; color: #111; }
      .comment { border-top: 1px solid var(--border); padding-top: 10px; margin-top: 10px; }
      .comment .who { font-weight: 600; }
      .comment .stars { white-space: nowrap; }
      .comment .date { color: var(--muted); font-size: 12px; }
      textarea { width: 100%; min-height: 90px; padding: 10px; border: 1px solid var(--border); border-radius: 8px; }
      select, input[type="text"], input[type="tel"] { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 8px; }

      /* Modals */
      .modal { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.5); display: none; align-items: center; justify-content: center; z-index: 20; }
      .modal.show { display: flex; }
      .modal-card { background: #fff; border-radius: 12px; border: 1px solid var(--border); max-width: 680px; width: 92vw; max-height: 86vh; overflow: auto; padding: 16px; }
      .modal-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
      .x { cursor: pointer; font-size: 20px; }
      body.no-scroll { overflow: hidden; }

      /* Cart list */
      .cart-item { display: flex; gap: 10px; align-items: center; border-bottom: 1px solid var(--border); padding: 10px 0; }
      .cart-item img { width: 56px; height: 56px; object-fit: cover; border-radius: 8px; border: 1px solid var(--border); }
      .cart-item .title { font-weight: 600; }
      .cart-item .price { color: var(--danger); font-weight: 700; }
      .cart-actions { display: flex; align-items: center; gap: 6px; }
      .qty-btn { padding: 4px 8px; border: 1px solid var(--border); border-radius: 6px; background: #fff; cursor: pointer; }
      .remove { background: #fff; color: var(--danger); border: 1px solid var(--danger); }
      .cart-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; }

      /* Steps */
      .steps { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 10px; }
      .step { padding: 6px 10px; border-radius: 999px; border: 1px solid var(--border); background: #f8fafc; }
      .step.active { background: var(--brand); color: #fff; border-color: var(--brand); }
      .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
      @media (max-width: 900px) { .container { flex-direction: column; } }

      /* Related */
      .related-products { margin: 40px 0; padding: 20px; background: #f8f8f8; border-radius: 10px; }
      .related-products h3 { margin-bottom: 20px; font-size: 20px; color: #333; }
      .related-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; }
      .related-item { background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,.1); text-align: center; transition: transform .2s; }
      .related-item:hover { transform: translateY(-5px); }
      .related-item img { width: 100%; height: auto; margin-bottom: 10px; }
      .related-title { font-size: 16px; font-weight: 600; margin: 5px 0; }
      .related-price { color: #009688; font-weight: bold; margin-bottom: 10px; display: block; }
      .view-btn { background: #009688; color: #fff; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; transition: background .3s; }
      .view-btn:hover { background: #00796b; }

      /* Seller Info button */
      #sellerInfo .btn.secondary { display: inline-block; margin-top: 12px; padding: 8px 14px; font-size: 14px; border-radius: 6px; text-decoration: none; background-color: #007bff; color: white; transition: .3s ease; }
      #sellerInfo .btn.secondary:hover { background-color: #0056b3; }
    </style>
  </head>
  <body>
    <a class="visually-hidden" href="#main">Skip to content</a>

    <!-- Header -->
    <header role="banner">
      <div class="brand" aria-label="Smart Farmer">üå± Smart Farmer</div>

      <form class="search" role="search" onsubmit="event.preventDefault(); handleSearch();">
        <label for="searchInput" class="visually-hidden">Search category</label>
        <input id="searchInput" placeholder="Search category..." autocomplete="off" />
        <button class="icon-btn" type="submit" aria-label="Search">üîç</button>
      </form>

      <div class="header-right">
        <button class="icon-btn badge" onclick="openCart()" aria-haspopup="dialog" aria-controls="cartModal">
          üõí Cart <span id="cartCountBadge">0</span>
        </button>
        <button class="icon-btn" aria-label="Notifications">üîî</button>
        <button class="icon-btn" aria-label="Account">üë§</button>
      </div>
    </header>

    <!-- Main -->
    <main id="main" class="container" role="main">
      <section class="left-section" aria-labelledby="galleryHeading">
        <h2 id="galleryHeading" class="visually-hidden">Product gallery</h2>
        <img id="mainImage" class="main-image" src="" alt="Product image" loading="eager" onerror="this.src='https://via.placeholder.com/800x800.png?text=No+Image';" />
        <div id="thumbnails" class="thumbnails" role="listbox" aria-label="Gallery thumbnails"></div>
      </section>

      <section class="right-section" aria-labelledby="productHeading">
        <div class="row" style="justify-content:space-between; align-items:flex-start;">
          <h1 id="productHeading" style="margin:0;">Loading‚Ä¶</h1>
          <span id="occasionPill" class="pill" style="display:none;" title="Occasion offer">üéâ <span>Special Offer</span></span>
        </div>
        <div class="meta">
          <span id="reviewCount">‚≠ê 0 Reviews</span> ¬∑ Brand: <strong id="productBrand"></strong>
        </div>

        <div class="price-box" aria-live="polite">
          <span id="productPrice" class="price-now"></span>
          <span id="oldPrice" class="old-price"></span>
          <span id="discount" class="discount" aria-label="Discount"></span>
        </div>

        <!-- Govt vs Seller comparison -->
<div id="priceCompare" class="row" style="gap:12px; align-items:flex-start; display:none;">
  <div class="pill" title="Govt reference price">
    üè∑Ô∏è <span>Govt: <strong id="govtPrice"></strong></span>
  </div>
  <div class="pill">
    üõí <span>Seller: <strong id="sellerPrice"></strong></span>
  </div>
  <div class="pill" id="deltaPill" aria-live="polite">
    <span id="deltaText"></span>
  </div>
</div>


        <div class="row">
          <label for="colorOptions"><strong>Color:</strong></label>
          <select id="colorOptions" aria-label="Select color"></select>
        </div>

        <div class="row qty">
          <strong>Quantity:</strong>
          <button class="qty-btn" onclick="changeQuantity(-1)" aria-label="Decrease quantity">‚àí</button>
          <input id="quantity" type="number" min="1" value="1" inputmode="numeric" />
          <button class="qty-btn" onclick="changeQuantity(1)" aria-label="Increase quantity">+</button>
        </div>

        <div class="row">
          <button class="btn primary" onclick="shopNow()" type="button">Shop Now</button>
          <button class="btn secondary" onclick="addToCart()" type="button">Add to Cart</button>
        </div>

        <div class="info-block" aria-live="polite">
          <div class="info-line"><strong>Delivery:</strong> <span id="deliveryEta">Calculating‚Ä¶</span></div>
          <div class="info-line"><strong>Payment:</strong> Cash on Delivery Available</div>
          <div class="info-line"><strong>Returns:</strong> 7 Days Return</div>
          <div id="checkoutNotice" class="info-line" style="display:none; color:var(--warn);">‚ö†Ô∏è COD not available for pre-orders.</div>
        </div>

        <div id="sellerInfo" class="seller-info"></div>
      </section>
    </main>

    <!-- Reviews -->
    <section class="reviews" aria-labelledby="reviewsHeading">
      <h3 id="reviewsHeading">Ratings & Reviews</h3>
      <div class="rating-head">
        <div class="avg-badge" id="averageRating" aria-live="polite">0.0</div>
        <div id="ratingStars" class="stars" aria-label="Average rating"></div>
        <div id="ratingBreakdown" class="rating-breakdown"></div>
      </div>

      <div id="reviewList"></div>

      <div class="comment-form" style="margin-top:14px">
        <h4>Add Your Review</h4>
        <div class="row">
          <label for="userRating"><strong>Your Rating:</strong></label>
          <select id="userRating" aria-label="Your rating">
            <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5)</option>
            <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê (4)</option>
            <option value="3">‚≠ê‚≠ê‚≠ê (3)</option>
            <option value="2">‚≠ê‚≠ê (2)</option>
            <option value="1">‚≠ê (1)</option>
          </select>
        </div>
        <label for="userComment" class="visually-hidden">Your comment</label>
        <textarea id="userComment" placeholder="Write your comment..."></textarea>
        <div class="row">
          <button class="btn primary" onclick="submitReview()" type="button">Submit Review</button>
        </div>
      </div>
    </section>

    <section class="related-products" aria-labelledby="relatedHeading">
      <h3 id="relatedHeading">Related Products</h3>
      <div class="related-list">
        <div class="related-item">
          <img src="https://via.placeholder.com/150" alt="Earbuds Case" loading="lazy" />
          <p class="related-title">Earbuds Case</p>
          <span class="related-price">‡ß≥150</span>
          <button class="view-btn" type="button">View</button>
        </div>
        <div class="related-item">
          <img src="https://via.placeholder.com/150" alt="Wireless Charger" loading="lazy" />
          <p class="related-title">Wireless Charger</p>
          <span class="related-price">‡ß≥800</span>
          <button class="view-btn" type="button">View</button>
        </div>
      </div>
    </section>

    <!-- CART MODAL -->
    <div id="cartModal" class="modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="cartTitle">
      <div class="modal-card">
        <div class="modal-head">
          <h3 id="cartTitle">Your Cart</h3>
          <button class="x" onclick="closeCart()" aria-label="Close cart">‚úñ</button>
        </div>
        <div id="cartItems"></div>
        <div class="cart-footer">
          <div><strong>Total:</strong> <span id="cartTotal">‡ß≥0</span></div>
          <div>
            <button class="btn secondary" onclick="closeCart()" type="button">Close</button>
            <button class="btn primary" onclick="openCheckout()" type="button">Proceed to Checkout</button>
          </div>
        </div>
      </div>
    </div>

    <!-- CHECKOUT MODAL -->
    <div id="checkoutModal" class="modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="coTitle">
      <div class="modal-card">
        <div class="modal-head">
          <h3 id="coTitle">Checkout</h3>
          <button class="x" onclick="closeCheckout()" aria-label="Close checkout">‚úñ</button>
        </div>

        <div class="steps" aria-label="Checkout steps">
          <div id="s1" class="step active">1. Shipping</div>
          <div id="s2" class="step">2. Payment</div>
          <div id="s3" class="step">3. Review</div>
        </div>

        <!-- Step 1 -->
        <div id="step1">
          <div class="grid-2">
            <div>
              <label for="coName">Full Name</label>
              <input id="coName" type="text" placeholder="Your name" autocomplete="name" />
            </div>
            <div>
              <label for="coPhone">Phone</label>
              <input id="coPhone" type="tel" placeholder="01XXXXXXXXX" autocomplete="tel" />
            </div>
          </div>
          <label for="coAddress">Address</label>
          <input id="coAddress" type="text" placeholder="House, Road, Area" autocomplete="street-address" />
          <div class="grid-2">
            <div>
              <label for="coDivision">Division</label>
              <input id="coDivision" type="text" placeholder="Dhaka" />
            </div>
            <div>
              <label for="coCity">City</label>
              <input id="coCity" type="text" placeholder="Dhaka City" />
            </div>
          </div>
          <div class="row" style="justify-content: flex-end">
            <button class="btn primary" onclick="goToStep(2)" type="button">Next ‚Üí</button>
          </div>
        </div>

        <!-- Step 2 -->
        <div id="step2" style="display: none">
          <label for="coPayment">Payment Method</label>
          <select id="coPayment">
            <option value="cod">Cash on Delivery</option>
            <option value="bkash">bKash/Nagad</option>
            <option value="card">Credit/Debit Card</option>
          </select>
          <div class="row" style="justify-content: space-between">
            <button class="btn secondary" onclick="goToStep(1)" type="button">‚Üê Back</button>
            <button class="btn primary" onclick="goToStep(3)" type="button">Next ‚Üí</button>
          </div>
        </div>

        <!-- Step 3 -->
        <div id="step3" style="display: none">
          <h4>Order Summary</h4>
          <div id="summaryList"></div>
          <p><strong>Grand Total:</strong> <span id="summaryTotal">‡ß≥0</span></p>
          <div class="row" style="justify-content: space-between">
            <button class="btn secondary" onclick="goToStep(2)" type="button">‚Üê Back</button>
            <button class="btn primary" onclick="placeOrder()" type="button">Place Order</button>
          </div>
        </div>
      </div>
    </div>



    <script>
      /* ---------- Utilities ---------- */
      const fmtBDT = (n) => "‡ß≥" + Number(n || 0).toLocaleString("en-BD", { maximumFractionDigits: 0 });
      const escapeHTML = (s) => String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"','&quot;').replaceAll("'","&#39;");
      const stars = (n) => "‚≠ê".repeat(n) + "‚òÜ".repeat(5 - n);

      /* ---------- Product Data (now with occasion + preorder) ---------- */
      const productData = {
        id: "r50i-case",
        title: "Anker Soundcore R50i NC Premium Silicone Case",
        brand: "No Brand",
        price: 238,
oldPrice: 400,
/* ‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡¶æ‡¶á‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶® */
govtPrice: 260, // (‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶£) ‡¶∏‡¶∞‡¶ï‡¶æ‡¶∞/MSRP ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶®‡ßç‡¶∏ ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø
colors: ["Transparent", "Black", "Red"],

        colors: ["Transparent", "Black", "Red"],
        images: [
          "https://via.placeholder.com/800x800.png?text=Main",
          "https://via.placeholder.com/800x800.png?text=Alt+1",
          "https://via.placeholder.com/800x800.png?text=Alt+2",
          "https://via.placeholder.com/800x800.png?text=Alt+3",
        ],
        seller: { name: "GadGizmo", rating: "87%", shipTime: "100%", responseRate: "100%" },
        reviews: [
          { user: "John D.", rating: 5, comment: "Great product!", date: "2025-08-01" },
          { user: "Ali H.", rating: 4, comment: "Good, but delivery was slow.", date: "2025-08-10" },
        ],
        occasion: { label: "Eid Offer", active: true },
        preorder: false
      };

      /* ---------- Cart (persisted) ---------- */
      const CART_KEY = "sf_cart";
      let cart = loadCart();
      function loadCart(){ try { return JSON.parse(localStorage.getItem(CART_KEY)) || []; } catch { return []; } }
      function saveCart(){ try { localStorage.setItem(CART_KEY, JSON.stringify(cart)); } catch(e){} }
      const cartCount = () => cart.reduce((s,i)=> s + (i.qty || 0), 0);
      function updateCartBadge(){ document.getElementById("cartCountBadge").textContent = cartCount(); }

      /* ---------- Page Init ---------- */
      function loadProduct(){
        document.getElementById("productHeading").textContent = productData.title;
        document.getElementById("productBrand").textContent = productData.brand;

        // Occasion pill
        const pill = document.getElementById("occasionPill");
        if (productData.occasion?.active){ pill.style.display = "inline-flex"; pill.querySelector("span").textContent = productData.occasion.label || "Special Offer"; }

        // Prices + discount
        document.getElementById("productPrice").textContent = fmtBDT(productData.price);
        const oldEl = document.getElementById("oldPrice");
        const discEl = document.getElementById("discount");
        if (productData.oldPrice && productData.oldPrice > productData.price){
          oldEl.textContent = fmtBDT(productData.oldPrice);
          const pct = Math.round((1 - productData.price / productData.oldPrice) * 100);
          discEl.textContent = `-${pct}%`;
          discEl.title = `${pct}% off`;
        } else { oldEl.textContent = ""; discEl.textContent = ""; }

        // Govt vs Seller comparison render
{
  const govt = Number(productData.govtPrice || 0);
  const seller = Number(productData.price || 0);
  const box = document.getElementById('priceCompare');

  if (govt > 0) {
    box.style.display = 'flex';
    document.getElementById('govtPrice').textContent = fmtBDT(govt);
    document.getElementById('sellerPrice').textContent = fmtBDT(seller);

    const delta = seller - govt;
    const pct = govt > 0 ? Math.round(Math.abs(delta) / govt * 100) : 0;
    const text = (delta <= 0)
      ? `‚ñº ${fmtBDT(Math.abs(delta))} (${pct}% ‡¶ï‡¶Æ Govt ‡¶•‡ßá‡¶ï‡ßá)`
      : `‚ñ≤ ${fmtBDT(delta)} (${pct}% ‡¶¨‡ßá‡¶∂‡¶ø Govt ‡¶•‡ßá‡¶ï‡ßá)`;

    const pill = document.getElementById('deltaPill');
    pill.classList.remove('delta-good', 'delta-bad');
    pill.classList.add(delta <= 0 ? 'delta-good' : 'delta-bad');
    document.getElementById('deltaText').textContent = text;
  } else {
    box.style.display = 'none';
  }
}


        // Delivery ETA (+3 days)
        const eta = new Date(); eta.setDate(eta.getDate() + 3);
        const parts = eta.toLocaleDateString("en-GB", { day:'2-digit', month:'short' });
        document.getElementById("deliveryEta").textContent = `Standard Delivery by ${parts}`;

        // Preorder notice
        document.getElementById("checkoutNotice").style.display = productData.preorder ? "block" : "none";

        // Gallery
        const main = document.getElementById("mainImage");
        main.src = productData.images[0];
        main.alt = productData.title + " main image";
        const thumbs = document.getElementById("thumbnails");
        thumbs.innerHTML = "";
        productData.images.forEach((src, i) => {
          const img = document.createElement("img");
          img.src = src; img.alt = productData.title + " thumbnail " + (i+1); img.loading = "lazy";
          img.setAttribute("role","option"); img.tabIndex = 0; img.setAttribute("aria-selected", i === 0 ? "true":"false");
          img.addEventListener("click", ()=> selectImage(i));
          img.addEventListener("keydown", (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); selectImage(i);} });
          if (i===0) img.classList.add("active");
          thumbs.appendChild(img);
        });

        // Colors
        const sel = document.getElementById("colorOptions");
        sel.innerHTML = "";
        productData.colors.forEach((c)=>{ const opt = document.createElement("option"); opt.value = c; opt.textContent = c; sel.appendChild(opt); });
        const urlColor = new URLSearchParams(location.search).get('color');
        if (urlColor && productData.colors.includes(urlColor)) sel.value = urlColor;

        // Seller
        document.getElementById("sellerInfo").innerHTML = `
          <h4>Seller Info</h4>
          <div class="info-line"><strong>Seller:</strong> ${escapeHTML(productData.seller.name)}</div>
          <div class="info-line"><strong>Positive Rating:</strong> ${escapeHTML(productData.seller.rating)}</div>
          <div class="info-line"><strong>Ship on Time:</strong> ${escapeHTML(productData.seller.shipTime)}</div>
          <div class="info-line"><strong>Response Rate:</strong> ${escapeHTML(productData.seller.responseRate)}</div>
          <div class="info-line">
            <a href="seller-public.html?seller=${encodeURIComponent(productData.seller.name)}" class="btn secondary">üè¨ Visit Seller Page</a>
          </div>`;

        // Reviews
        renderReviews();

        // Cart badge
        updateCartBadge();

        // Keyboard: close modals by ESC
        document.addEventListener('keydown', onGlobalKey);
      }

      function selectImage(i){
        const thumbs = document.getElementById("thumbnails");
        const main = document.getElementById("mainImage");
        const src = productData.images[i];
        main.src = src; [...thumbs.children].forEach((c,idx)=>{ c.classList.toggle('active', idx===i); c.setAttribute('aria-selected', idx===i? 'true':'false'); });
      }

      /* ---------- Quantity ---------- */
      function changeQuantity(d){ const input = document.getElementById("quantity"); let v = parseInt(input.value || "1", 10) + d; if (Number.isNaN(v) || v < 1) v = 1; if (v > 999) v = 999; input.value = v; }

      /* ---------- Cart UI ---------- */
      function addToCart(){
        const qty = Math.min(999, Math.max(1, parseInt(document.getElementById("quantity").value || "1", 10)));
        const color = document.getElementById("colorOptions").value;
        const key = productData.id + "||" + color;
        const existing = cart.find((i)=> i.key === key);
        if (existing) existing.qty += qty; else cart.push({ key, id: productData.id, title: productData.title, price: productData.price, qty, color, image: document.getElementById("mainImage").src });
        saveCart(); updateCartBadge(); openCart();
      }

      function openCart(){
        const list = document.getElementById("cartItems"); list.innerHTML = ""; let total = 0;
        if (cart.length === 0){ list.innerHTML = `<p>Your cart is empty.</p>`; }
        else {
          cart.forEach((it, idx)=>{
            const line = document.createElement("div"); line.className = "cart-item";
            line.innerHTML = `
              <img src="${it.image}" alt="cart item" />
              <div style="flex:1;min-width:150px">
                <div class="title">${escapeHTML(it.title)}</div>
                <div class="meta">Color: ${escapeHTML(it.color)}</div>
                <div class="price">${fmtBDT(it.price)}</div>
              </div>
              <div class="cart-actions">
                <button class="qty-btn" onclick="cartDec(${idx})" aria-label="Decrease">‚àí</button>
                <div aria-live="polite">${it.qty}</div>
                <button class="qty-btn" onclick="cartInc(${idx})" aria-label="Increase">+</button>
                <button class="qty-btn remove" onclick="cartRemove(${idx})">Remove</button>
              </div>`;
            list.appendChild(line); total += it.price * it.qty;
          });
        }
        document.getElementById("cartTotal").textContent = fmtBDT(total);
        showModal('cartModal');
      }
      function closeCart(){ hideModal('cartModal'); }
      function cartInc(i){ cart[i].qty++; saveCart(); openCart(); updateCartBadge(); }
      function cartDec(i){ cart[i].qty = Math.max(1, cart[i].qty - 1); saveCart(); openCart(); updateCartBadge(); }
      function cartRemove(i){ cart.splice(i,1); saveCart(); openCart(); updateCartBadge(); }

      /* ---------- Checkout Modal & Steps ---------- */
      function shopNow(){ openCheckout(); }
      function openCheckout(){
        if (cart.length === 0){
          const qty = Math.min(999, Math.max(1, parseInt(document.getElementById("quantity").value || "1", 10)));
          const color = document.getElementById("colorOptions").value;
          cart.push({ key: productData.id + "||" + color, id: productData.id, title: productData.title, price: productData.price, qty, color, image: document.getElementById("mainImage").src });
          saveCart(); updateCartBadge();
        }
        hideModal('cartModal'); goToStep(1); buildSummary(); showModal('checkoutModal');
      }
      function closeCheckout(){ hideModal('checkoutModal'); }

      function setStepBadge(n){ [1,2,3].forEach((i)=> document.getElementById("s"+i).classList.toggle("active", i===n)); }
      function goToStep(n){ setStepBadge(n); document.getElementById("step1").style.display = (n===1?"block":"none"); document.getElementById("step2").style.display = (n===2?"block":"none"); document.getElementById("step3").style.display = (n===3?"block":"none"); if(n===3) buildSummary(); // If preorder, disable COD in Step 2
if (n === 2 && productData.preorder) {
  const sel = document.getElementById('coPayment');
  const codOpt = [...sel.options].find(o => o.value === 'cod');
  if (codOpt) codOpt.disabled = true;
  if (sel.value === 'cod') sel.value = 'bkash';
}
 }

      function buildSummary(){ const wrap = document.getElementById("summaryList"); wrap.innerHTML = ""; let total = 0; cart.forEach((it)=>{ const row = document.createElement("div"); row.style.display = "flex"; row.style.justifyContent = "space-between"; row.style.margin = "6px 0"; row.innerHTML = `<div>${escapeHTML(it.title)} <span style="color:#6b7280">(${escapeHTML(it.color)})</span> √ó ${it.qty}</div><div>${fmtBDT(it.price * it.qty)}</div>`; wrap.appendChild(row); total += it.price * it.qty; }); document.getElementById("summaryTotal").textContent = fmtBDT(total); }

      function placeOrder(){
        const name = document.getElementById("coName").value.trim();
        const phone = document.getElementById("coPhone").value.trim();
        const address = document.getElementById("coAddress").value.trim();
        const phoneOk = /^(?:\+?88)?01[3-9]\d{8}$/.test(phone);
        if (!name || !phoneOk || !address){ alert("Please fill valid Shipping info (Step 1). Phone must be BD format."); goToStep(1); return; }
        alert("Order placed! ‚úÖ Thank you."); cart = []; saveCart(); updateCartBadge(); closeCheckout();
      }

      /* ---------- Reviews ---------- */
      function renderReviews(){
        const reviews = productData.reviews || [];
        document.getElementById("reviewCount").textContent = `‚≠ê ${reviews.length} Reviews`;
        let avg = 0; if (reviews.length){ avg = reviews.reduce((s,r)=> s + (parseInt(r.rating,10)||0), 0) / reviews.length; }
        document.getElementById("averageRating").textContent = avg.toFixed(1);
        document.getElementById("ratingStars").textContent = stars(Math.round(avg));
        const counts = {1:0,2:0,3:0,4:0,5:0}; reviews.forEach((r)=>{ const k = Math.min(5, Math.max(1, parseInt(r.rating,10)||0)); counts[k]++; });
        const bd = document.getElementById("ratingBreakdown"); bd.innerHTML = ""; for(let s=5;s>=1;s--){ const span = document.createElement("span"); span.textContent = `${s}‚òÖ (${counts[s]})`; bd.appendChild(span); }
        const list = document.getElementById("reviewList"); list.innerHTML = ""; reviews.forEach((r)=>{ const item = document.createElement("div"); item.className = "comment"; const nm = escapeHTML(r.user||"User"); const dt = escapeHTML(r.date||""); const msg = escapeHTML(r.comment||""); const st = stars(Math.min(5, Math.max(1, parseInt(r.rating,10)||0))); item.innerHTML = `<div class="who">${nm} <span class="stars">${st}</span> <span class="date">(${dt})</span></div><div>${msg}</div>`; list.appendChild(item); });
      }

      function submitReview(){ const rating = Math.min(5, Math.max(1, parseInt(document.getElementById("userRating").value,10)||5)); const comment = document.getElementById("userComment").value.trim(); if(!comment){ alert("Comment is required!"); return; } productData.reviews.push({ user: "Anonymous", rating, comment, date: new Date().toISOString().split("T")[0] }); document.getElementById("userComment").value = ""; renderReviews(); document.getElementById("reviewList").lastElementChild?.scrollIntoView({ behavior: "smooth", block: "center" }); }

      /* ---------- Search ---------- */
      function handleSearch(){ const term = document.getElementById("searchInput").value.trim(); if (term){ const url = `marketplace.html?category=${encodeURIComponent(term)}`; window.location.href = url; } }

      /* ---------- Modal helpers (focus trap, backdrop click, ESC) ---------- */
      function showModal(id){ const el = document.getElementById(id); el.classList.add('show'); el.setAttribute('aria-hidden','false'); document.body.classList.add('no-scroll'); trapFocus(el); el.addEventListener('mousedown', onBackdrop); }
      function hideModal(id){ const el = document.getElementById(id); el.classList.remove('show'); el.setAttribute('aria-hidden','true'); document.body.classList.remove('no-scroll'); releaseFocus(el); el.removeEventListener('mousedown', onBackdrop); }
      function onBackdrop(e){ const card = e.currentTarget.querySelector('.modal-card'); if (!card.contains(e.target)) { // clicked outside card
          if (e.currentTarget.id === 'cartModal') closeCart(); else closeCheckout();
        }
      }
      function onGlobalKey(e){ if (e.key === 'Escape'){ const cm = document.getElementById('cartModal'); const ch = document.getElementById('checkoutModal'); if (cm.classList.contains('show')) closeCart(); if (ch.classList.contains('show')) closeCheckout(); } }

      // Simple focus trap
      let lastFocused = null;
      function trapFocus(container){ lastFocused = document.activeElement; const focusables = container.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'); const first = focusables[0]; const last = focusables[focusables.length-1]; function loop(e){ if(e.key !== 'Tab') return; if(e.shiftKey && document.activeElement === first){ e.preventDefault(); last.focus(); } else if(!e.shiftKey && document.activeElement === last){ e.preventDefault(); first.focus(); } } container.addEventListener('keydown', loop); container._loop = loop; first?.focus(); }
      function releaseFocus(container){ if (container?._loop) container.removeEventListener('keydown', container._loop); lastFocused?.focus(); }

      /* ---------- Expose minimal API ---------- */
      window.changeQuantity = changeQuantity;
      window.addToCart = addToCart;
      window.openCart = openCart;
      window.closeCart = closeCart;
      window.cartInc = cartInc;
      window.cartDec = cartDec;
      window.cartRemove = cartRemove;
      window.openCheckout = openCheckout;
      window.closeCheckout = closeCheckout;
      window.goToStep = goToStep;
      window.placeOrder = placeOrder;
      window.submitReview = submitReview;
      window.handleSearch = handleSearch;
      window.shopNow = shopNow;

      // Init
      loadProduct();

      /* ---------- Structured Data (SEO) ---------- */
      const ld = {
        "@context":"https://schema.org",
        "@type":"Product",
        "name": productData.title,
        "brand": productData.brand,
        "image": productData.images,
        "offers": {
          "@type":"Offer",
          "priceCurrency":"BDT",
          "price": String(productData.price),
          "availability": "https://schema.org/InStock"
        },
        "aggregateRating": {
          "@type":"AggregateRating",
          "ratingValue": (productData.reviews?.length? (productData.reviews.reduce((s,r)=>s+r.rating,0)/productData.reviews.length).toFixed(1):"0"),
          "reviewCount": String(productData.reviews?.length||0)
        }
      };

      // Optional: expose Govt/MSRP in structured data
if (productData.govtPrice) {
  ld.offers.priceSpecification = {
    "@type": "UnitPriceSpecification",
    "price": String(productData.govtPrice),
    "priceCurrency": "BDT",
    "priceComponentType": "https://schema.org/MSRP"
  };
}

      const s = document.createElement('script'); s.type='application/ld+json'; s.textContent = JSON.stringify(ld); document.head.appendChild(s);
    </script>
  </body>
</html>
