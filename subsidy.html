<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Agriculture Subsidy Announcements & Tracker</title>
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'ui-sans-serif', 'system-ui']
          },
          boxShadow: {
            soft: '0 10px 30px rgba(0,0,0,0.08)',
            lift: '0 12px 40px rgba(16,185,129,0.25)'
          }
        }
      }
    }
  </script>
  <!-- Inter (English) -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />

  <style>
    /* Minimal extra CSS beyond Tailwind */
:root{
  --ring: 0 0 0 3px rgba(16, 185, 129, 0.35);
}
.tab-btn{
  border-radius: 0.75rem;
  padding: 0.6rem 0.9rem;
  font-size: 0.95rem;
  background: #ecfdf5;
  color: #065f46;
  border: 1px solid #a7f3d0;
  transition: all .15s ease;
}
.tab-btn:hover{ filter: brightness(0.98); }
.tab-active{
  background: #065f46 !important;
  color: #fff !important;
  border-color: #065f46 !important;
}
.label{ display:block; font-size:0.9rem; color:#334155; margin-bottom:6px; }
.input{
  width:100%; border:1px solid #e2e8f0; border-radius:0.75rem; padding:0.7rem 1rem;
  outline:none; background:#fff;
}
.input:focus{ box-shadow: var(--ring); border-color:#10b981; }
.badge{
  display:inline-flex; align-items:center; gap:.4rem; border-radius:999px; padding:.25rem .6rem; font-size:.8rem; font-weight:600;
}
.badge-open{ background:#d1fae5; color:#065f46; border:1px solid #a7f3d0; }
.badge-closed{ background:#ffe4e6; color:#9f1239; border:1px solid #fecdd3; }
.badge-expired{ background:#fef3c7; color:#92400e; border:1px solid #fde68a; }
.card{ border-radius:1.1rem; background:#fff; box-shadow:0 10px 30px rgba(0,0,0,0.08); padding:1rem; display:flex; flex-direction:column; gap:.6rem; }
.card:hover{ transform: translateY(-2px); transition:transform .12s ease; }
.softlist li+li{ margin-top:.25rem; }
  </style>
</head>
<body class="font-sans">
     <header class="top-bar">
        <div class="top-left">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/3b/Green_cow_logo.svg/512px-Green_cow_logo.svg.png"
                alt="Logo" class="logo">
            <span class="brand">Smart Farmers</span>
        </div>

        <div class="top-center">
            <a href="live weather.html"><button id="weather-btn">üå§ Live Weather</button></a>
        </div>

        <div class="top-right">
            <a href="ai chat.html"> <button id="voice-btn">üé§ AI Voice Assistant</button></a>
        </div>
    </header>

    <!-- Navigation Bar -->
    <section>
        <nav class="navbar">
            <div class="nav-container">
                <ul class="nav-menu">
                    <li><a href="index.html" class="nav-link">Home</a></li>
                    <li><a href="about.html" class="nav-link">About</a></li>

                    <li class="dropdown">
                        <a href="#" class="nav-link active">Farming</a>
                        <ul class="dropdown-menu">
                            <li><a href="fruitCrops.html">Fruit Crops</a></li>
                            <li><a href="fieldCrops.html">Field Crops</a></li>
                            <li><a href="vegetable.html">Vegetable Crops</a></li>
                            <li><a href="organic.html">Organic Culture</a></li>
                            <li><a href="water-management.html">Water Management</a></li>
                        </ul>
                    </li>

                    <li><a href="service.html" class="nav-link">Services</a></li>
                    <li><a href="subsidy.html" class="nav-link">Subsidy</a></li>

                    <li class="dropdown">
                        <a href="#" class="nav-link active">Market_place</a>
                        <ul class="dropdown-menu">
                            <li><a href="seller.html">Seller</a></li>
                            <li><a href="buyer.html">Buyer</a></li>
                        </ul>
                    </li>

                    <li><a href="blog.html" class="nav-link">Blog</a></li>
                    <li><a href="#" class="nav-link">Gallery</a></li>
                    <li><a href="#" class="nav-link">Elements</a></li>
                    <li><a href="#" class="nav-link">Faq</a></li>
                    <li><a href="#" class="nav-link">Contact</a></li>
                </ul>
            </div>
        </nav>
    </section>

  <!-- Hero -->
  <header class="relative overflow-hidden">
    <div class="absolute inset-0 -z-10 bg-gradient-to-br from-lime-400 via-emerald-400 to-green-600"></div>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-10">
      <div class="flex items-center justify-between gap-3">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 rounded-2xl bg-white/15 flex items-center justify-center shadow-soft">
            <svg class="w-7 h-7 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7S2 12 2 12Z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 5v14" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5 12h14" />
            </svg>
          </div>
          <div>
            <h1 class="text-3xl sm:text-4xl font-extrabold text-white drop-shadow">Agriculture Subsidy</h1>
            <p class="text-white/90">View announcements ‚Ä¢ Apply ‚Ä¢ Track status</p>
          </div>
        </div>
        <div class="flex items-center gap-2">
          <button id="helpBtn" class="px-3 py-2 rounded-xl bg-white/15 text-white hover:bg-white/25 text-sm">Help</button>
          <button id="adminToggle" class="px-3 py-2 rounded-xl bg-white text-emerald-700 hover:bg-emerald-50 text-sm shadow-soft">Admin</button>
        </div>
      </div>
      <!-- steps -->
      <div class="mt-4 sm:mt-8 grid grid-cols-1 sm:grid-cols-3 gap-3">
        <div class="rounded-2xl bg-white/10 backdrop-blur p-4 text-white shadow-soft">
          <div class="text-lg font-semibold">1) View Announcements</div>
          <div class="text-white/90 text-sm">Pick an open scheme</div>
        </div>
        <div class="rounded-2xl bg-white/10 backdrop-blur p-4 text-white shadow-soft">
          <div class="text-lg font-semibold">2) Apply</div>
          <div class="text-white/90 text-sm">Fill the simple form</div>
        </div>
        <div class="rounded-2xl bg-white/10 backdrop-blur p-4 text-white shadow-soft">
          <div class="text-lg font-semibold">3) See Status</div>
          <div class="text-white/90 text-sm">Get SMS/Call on approval</div>
        </div>
      </div>
    </div>
  </header>

  <!-- Tabs & Filters -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 -mt-6 pb-24">
    <div class="bg-white rounded-2xl shadow-soft p-3 sm:p-4">
      <div class="flex flex-wrap items-center gap-2">
        <button data-tab="announcements" class="tab-btn tab-active">üì¢ Announcements</button>
        <button data-tab="apply" class="tab-btn">üìù Apply & Tracking</button>
        <button data-tab="help" class="tab-btn">‚ùì Help</button>

        <div class="ml-auto flex flex-wrap items-center gap-2 w-full sm:w-auto">
          <div class="relative flex-1 sm:flex-none">
            <input id="searchInput" type="text" placeholder="Search schemes‚Ä¶"
              class="w-full sm:w-64 px-4 py-3 rounded-xl bg-emerald-50 border border-emerald-200 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent text-sm pr-9">
            <svg class="w-4 h-4 absolute right-3 top-1/2 -translate-y-1/2 text-emerald-600" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <circle cx="11" cy="11" r="8" stroke-width="1.5"></circle>
              <path d="M21 21l-4.3-4.3" stroke-width="1.5" stroke-linecap="round"></path>
            </svg>
          </div>
          <select id="statusFilter" class="px-3 py-3 rounded-xl bg-emerald-50 border border-emerald-200 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500">
            <option value="all">All statuses</option>
            <option value="open">Open</option>
            <option value="closed">Closed</option>
            <option value="expired">Expired</option>
          </select>
          <button id="addSchemeBtn" class="hidden admin-only px-4 py-3 rounded-xl bg-emerald-600 text-white text-sm hover:bg-emerald-700 shadow-lift">+ New Scheme</button>
        </div>
      </div>
    </div>

    <!-- Announcements -->
    <section id="announcements" class="tab-panel mt-5 grid gap-4 sm:gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3">
      <!-- JS renders cards here -->
    </section>

    <!-- Apply & Tracking -->
    <section id="apply" class="tab-panel mt-5 hidden">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Form -->
        <div class="bg-white rounded-2xl shadow-soft p-5">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-xl font-bold">üìù Application Form</h3>
            <button id="clearFormBtn" class="text-sm text-slate-500 hover:underline">Clear form</button>
          </div>
          <form id="applyForm" class="space-y-4">
            <div>
              <label class="label">Name</label>
              <input name="name" class="input" placeholder="e.g., Rahim Uddin" required>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label class="label">NID / ID</label>
                <input name="nid" class="input" placeholder="10‚Äì17 digits" required>
              </div>
              <div>
                <label class="label">Mobile</label>
                <input name="phone" class="input" placeholder="01XXXXXXXXX" required>
              </div>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label class="label">Sector</label>
                <select name="farmType" class="input">
                  <option value="Crops">Crops</option>
                  <option value="Livestock">Livestock</option>
                  <option value="Fisheries">Fisheries</option>
                  <option value="Horticulture">Horticulture</option>
                </select>
              </div>
              <div>
                <label class="label">Upazila/Union</label>
                <input name="location" class="input" placeholder="e.g., Savar, Ashulia">
              </div>
            </div>
            <div>
              <label class="label">Choose Scheme</label>
              <select name="schemeId" id="schemeSelect" class="input"></select>
            </div>
            <div>
              <label class="label">Notes (optional)</label>
              <textarea name="notes" class="input min-h-[100px]" placeholder="Anything you want to mention‚Ä¶"></textarea>
            </div>
            <button class="w-full py-3 rounded-xl bg-emerald-600 text-white font-semibold hover:bg-emerald-700 shadow-lift">Submit Application</button>
          </form>
        </div>
        <!-- Tracking -->
        <div class="bg-white rounded-2xl shadow-soft p-5">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-xl font-bold">üì¶ My Applications</h3>
            <div class="flex gap-2">
              <button id="exportBtn" class="text-sm px-3 py-2 rounded-xl border border-emerald-200 hover:bg-emerald-50">Export Data</button>
              <label for="importFile" class="text-sm px-3 py-2 rounded-xl border border-emerald-200 hover:bg-emerald-50 cursor-pointer">Import</label>
              <input id="importFile" type="file" accept="application/json" class="hidden">
            </div>
          </div>
          <div class="text-sm text-slate-600 mb-3">Click the status to see details.</div>
          <div id="applicationsList" class="space-y-4"></div>
        </div>
      </div>
    </section>

    <!-- Help -->
    <section id="help" class="tab-panel mt-5 hidden">
      <div class="bg-white rounded-2xl shadow-soft p-5 space-y-4">
        <h3 class="text-xl font-bold">‚ùì How to use</h3>
        <ul class="list-disc pl-6 space-y-2 text-slate-700">
          <li>üì¢ Go to <span class="font-medium">Announcements</span> to view open schemes.</li>
          <li>üü¢ On an <span class="font-medium">Open</span> scheme, click <span class="font-medium">Apply</span>.</li>
          <li>üìù Fill your information and submit.</li>
          <li>üì¶ See status under <span class="font-medium">My Applications</span>: Submitted ‚Üí Under Review ‚Üí Approved / Rejected.</li>
          <li>üõ°Ô∏è Your data is saved only on this device (localStorage).</li>
        </ul>
        <p class="text-sm text-slate-500">Note: Click the Admin button and enter PIN <code class="px-1 rounded bg-slate-100">1234</code> to add/edit schemes.</p>
      </div>
    </section>
  </main>

  <!-- Scheme Modal -->
  <div id="schemeModal" class="fixed inset-0 hidden items-end sm:items-center justify-center z-50">
    <div class="absolute inset-0 bg-black/40" data-close-modal></div>
    <div class="w-full sm:max-w-xl bg-white rounded-t-2xl sm:rounded-2xl shadow-soft p-6 sm:mx-4">
      <div class="flex items-center justify-between mb-4">
        <h3 id="modalTitle" class="text-xl font-bold">New Scheme</h3>
        <button data-close-modal class="p-2 rounded-lg hover:bg-slate-100">
          <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <form id="schemeForm" class="space-y-4">
        <input type="hidden" name="id">
        <div>
          <label class="label">Title</label>
          <input name="title" class="input" placeholder="e.g., Fertilizer Subsidy 2025" required>
        </div>
        <div>
          <label class="label">Organization</label>
          <input name="org" class="input" placeholder="e.g., Ministry of Agriculture" required>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
          <div>
            <label class="label">Open Date</label>
            <input name="openDate" type="date" class="input" required>
          </div>
          <div>
            <label class="label">Close Date</label>
            <input name="closeDate" type="date" class="input" required>
          </div>
          <div>
            <label class="label">Status</label>
            <select name="status" class="input">
              <option value="open">Open</option>
              <option value="closed">Closed</option>
              <option value="expired">Expired</option>
            </select>
          </div>
        </div>
        <div>
          <label class="label">Benefit Summary</label>
          <input name="benefit" class="input" placeholder="e.g., Up to 40% cost support">
        </div>
        <div>
          <label class="label">Description</label>
          <textarea name="description" class="input min-h-[120px]" placeholder="Short details‚Ä¶"></textarea>
        </div>
        <div class="flex items-center justify-between gap-3">
          <button type="button" data-close-modal class="px-4 py-2 rounded-xl border border-slate-200 hover:bg-slate-50">Cancel</button>
          <button class="px-4 py-2 rounded-xl bg-emerald-600 text-white font-semibold hover:bg-emerald-700">Save</button>
        </div>
      </form>
    </div>
  </div>

  <section>
    <footer>
      <div class="footer-top">
        <div class="footer-column logo-desc">
          <h2><span class="leaf">üåø</span> Smart Farming</h2>
          <p>Organic farming benefits a wide range of organisms. It restores biodiversity, resources, and habitats of the region. The symbiosis between flora and fauna, animals, and humans in a chemical-free environment is paradise on Earth.</p>
        </div>
        <div class="footer-column contact">
          <h3>Contact</h3>
          <p><i class="fas fa-map-marker-alt"></i> Anthony Benoit 490 E Main Street Norwich CT 06360</p>
          <p><i class="fas fa-phone"></i> +1 (2) 345 6789</p>
          <p><i class="fas fa-fax"></i> +1 (2) 345 6789</p>
          <p><i class="fas fa-envelope"></i> contact@yourdomain.com</p>
        </div>
        <div class="footer-column social">
          <h3>Follow Us</h3>
          <div class="social-icons">
            <a href="#"><i class="fab fa-facebook-f"></i></a>
            <a href="#"><i class="fab fa-twitter"></i></a>
            <a href="#"><i class="fab fa-google"></i></a>
            <a href="#"><i class="fab fa-instagram"></i></a>
          </div>
        </div>
        <div class="footer-column subscribe">
          <h3>Subscribe</h3>
          <p>Enter your email and we‚Äôll send the latest information and plans.</p>
          <div class="subscribe-form">
            <input type="email" placeholder="Your Email ID" id="subscribe-email">
            <button id="subscribe-btn"><i class="fas fa-envelope"></i></button>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <p>Copyright ¬© 2018. All rights reserved by, DesignThemes</p>
        <nav>
          <a href="index.html">Home</a>
          <a href="#">Join Us</a>
          <a href="service.html">Services</a>
          <a href="about.html">About</a>
          <a href="#">Contact</a>
        </nav>
      </div>
    </footer>
  </section>

  <script>
/* Agriculture Subsidy ‚Äî English UI (Frontend)
 * Tech: HTML + Tailwind CDN + Plain CSS + Vanilla JS
 * Storage: localStorage
 */

const $ = (s, el=document)=>el.querySelector(s);
const $$ = (s, el=document)=>[...el.querySelectorAll(s)];

const store = {
  get schemes(){ return JSON.parse(localStorage.getItem('bn_schemes')||'[]'); },
  set schemes(v){ localStorage.setItem('bn_schemes', JSON.stringify(v)); },
  get apps(){ return JSON.parse(localStorage.getItem('bn_apps')||'[]'); },
  set apps(v){ localStorage.setItem('bn_apps', JSON.stringify(v)); },
};

// Seed
(function seed(){
  if (store.schemes.length===0){
    store.schemes = [
      {
        id: crypto.randomUUID(),
        title: "Fertilizer Subsidy 2025",
        org: "Ministry of Agriculture",
        openDate: "2025-08-01",
        closeDate: "2025-09-30",
        status: "open",
        benefit: "Up to 40% cost support",
        description: "Support for smallholders to purchase Urea, TSP, DAP.",
        createdAt: Date.now()
      },
      {
        id: crypto.randomUUID(),
        title: "Solar Irrigation Pump Grant",
        org: "Sustainable & Renewable Energy Authority",
        openDate: "2025-06-15",
        closeDate: "2025-08-31",
        status: "open",
        benefit: "Grant for purchase & installation",
        description: "Promote clean irrigation and reduce diesel expenses.",
        createdAt: Date.now()
      },
      {
        id: crypto.randomUUID(),
        title: "Paddy Seedling Assistance (Aman)",
        org: "Department of Agricultural Extension",
        openDate: "2025-05-01",
        closeDate: "2025-06-15",
        status: "expired",
        benefit: "Free certified seedlings",
        description: "Distribution of resilient, high-yielding seedlings.",
        createdAt: Date.now()
      }
    ];
  }
})();

const el = {
  year: $("#year"),
  tabs: $$(".tab-btn"),
  panels: $$(".tab-panel"),
  announcements: $("#announcements"),
  schemeModal: $("#schemeModal"),
  schemeForm: $("#schemeForm"),
  modalTitle: $("#modalTitle"),
  addSchemeBtn: $("#addSchemeBtn"),
  adminToggle: $("#adminToggle"),
  searchInput: $("#searchInput"),
  statusFilter: $("#statusFilter"),
  schemeSelect: $("#schemeSelect"),
  applyForm: $("#applyForm"),
  clearFormBtn: $("#clearFormBtn"),
  applicationsList: $("#applicationsList"),
  exportBtn: $("#exportBtn"),
  importFile: $("#importFile"),
  helpBtn: $("#helpBtn"),
};

// Utils
function todayStr(){ return new Date().toISOString().slice(0,10); }
function fmtDate(s){
  if(!s) return "";
  const d=new Date(s+"T00:00:00");
  return d.toLocaleDateString('en-US',{year:'numeric',month:'short',day:'numeric'});
}
function computedStatus(s){
  if (s.status==='expired') return 'expired';
  const t=todayStr();
  if (s.closeDate < t) return 'expired';
  if (s.status==='closed') return 'closed';
  return 'open';
}
function statusBadge(st){
  const cls = st==='open' ? 'badge-open' : st==='closed' ? 'badge-closed' : 'badge-expired';
  const label = st==='open' ? 'Open' : st==='closed' ? 'Closed' : 'Expired';
  return `<span class="badge ${cls}">${label}</span>`;
}

// Tabs
el.tabs.forEach(btn=>btn.addEventListener('click',()=>{
  el.tabs.forEach(b=>b.classList.remove('tab-active'));
  btn.classList.add('tab-active');
  const name = btn.dataset.tab;
  el.panels.forEach(p=>p.classList.toggle('hidden', p.id!==name));
  window.scrollTo({top:0,behavior:'smooth'});
}));
el.helpBtn.addEventListener('click',()=>{
  document.querySelector('[data-tab="help"]').click();
});

// Admin mode
let admin = false;
function applyAdminUI(){
  $$(".admin-only").forEach(x=>x.classList.toggle('hidden', !admin));
  el.adminToggle.textContent = admin ? "Admin ‚úì" : "Admin";
}
el.adminToggle.addEventListener('click',()=>{
  if (!admin){
    const pin = prompt("Enter Admin PIN (demo: 1234):");
    if (pin!=="1234"){ alert("Incorrect PIN"); return; }
  }
  admin = !admin;
  applyAdminUI();
});
applyAdminUI();

// Modal controls
function openSchemeModal(s=null){
  el.schemeModal.classList.remove('hidden');
  el.schemeModal.classList.add('flex');
  el.schemeForm.reset();
  el.modalTitle.textContent = s ? "Edit Scheme" : "New Scheme";
  if (s){
    el.schemeForm.id.value = s.id;
    el.schemeForm.title.value = s.title;
    el.schemeForm.org.value = s.org;
    el.schemeForm.openDate.value = s.openDate;
    el.schemeForm.closeDate.value = s.closeDate;
    el.schemeForm.status.value = s.status;
    el.schemeForm.benefit.value = s.benefit||"";
    el.schemeForm.description.value = s.description||"";
  }
}
function closeSchemeModal(){
  el.schemeModal.classList.add('hidden');
  el.schemeModal.classList.remove('flex');
}
$("[data-close-modal]").addEventListener('click', closeSchemeModal);
$$("[data-close-modal]", el.schemeModal).forEach(b=>b.addEventListener('click', closeSchemeModal));

el.addSchemeBtn.addEventListener('click',()=>openSchemeModal());

el.schemeForm.addEventListener('submit',(e)=>{
  e.preventDefault();
  const v = Object.fromEntries(new FormData(el.schemeForm).entries());
  const item = {
    id: v.id || crypto.randomUUID(),
    title: v.title.trim(),
    org: v.org.trim(),
    openDate: v.openDate,
    closeDate: v.closeDate,
    status: v.status,
    benefit: (v.benefit||"").trim(),
    description: (v.description||"").trim(),
    createdAt: Date.now()
  };
  const list = store.schemes;
  const i = list.findIndex(x=>x.id===item.id);
  if (i>=0) list[i]=item; else list.push(item);
  store.schemes = list;
  closeSchemeModal();
  refresh();
  alert("Scheme saved");
});

// Render announcements
function renderSchemes(){
  const q = el.searchInput.value.toLowerCase();
  const f = el.statusFilter.value;
  const list = store.schemes
    .map(s=>({...s, statusComputed: computedStatus(s)}))
    .filter(s=> (f==='all' || s.statusComputed===f))
    .filter(s=> s.title.toLowerCase().includes(q) || (s.org||'').toLowerCase().includes(q))
    .sort((a,b)=> a.statusComputed==='open' ? -1 : 1);

  el.announcements.innerHTML = list.map(s=>{
    const descFull = (s.description||"");
    const desc = descFull.slice(0,110) + (descFull.length>110 ? "‚Ä¶" : "");
    const tone = s.statusComputed==='open' ? "from-emerald-50 to-emerald-100 border-emerald-200" :
                 s.statusComputed==='closed' ? "from-rose-50 to-rose-100 border-rose-200" :
                 "from-amber-50 to-amber-100 border-amber-200";
    return `<article class="card bg-gradient-to-b ${tone} border">
      <div class="flex items-start justify-between gap-2">
        <h3 class="text-lg font-bold leading-tight">${s.title}</h3>
        ${statusBadge(s.statusComputed)}
      </div>
      <p class="text-sm text-slate-700">${s.org}</p>
      ${s.benefit ? `<div class="text-sm rounded-xl px-3 py-1 bg-white border border-emerald-200 inline-block">${s.benefit}</div>` : ""}
      <p class="text-sm text-slate-700">${desc}</p>
      <div class="text-xs text-slate-600">Application window: ${fmtDate(s.openDate)} ‚Äì ${fmtDate(s.closeDate)}</div>
      <div class="mt-2 flex items-center justify-between">
        <button class="px-3 py-2 text-sm rounded-xl bg-white border border-slate-200 hover:bg-slate-50" data-view="${s.id}">Details</button>
        <div class="flex items-center gap-2">
          <button class="px-3 py-2 text-sm rounded-xl bg-emerald-600 text-white hover:bg-emerald-700" data-apply="${s.id}" ${s.statusComputed!=='open'?'disabled':''}>Apply</button>
          <button class="admin-only px-3 py-2 text-sm rounded-xl bg-slate-900 text-white hover:bg-slate-800" data-edit="${s.id}">Edit</button>
          <button class="admin-only px-3 py-2 text-sm rounded-xl border border-rose-200 text-rose-600 hover:bg-rose-50" data-del="${s.id}">Delete</button>
        </div>
      </div>
    </article>`;
  }).join('');

  // actions
  $$("#announcements [data-view]").forEach(b=>b.addEventListener('click',()=>{
    const id = b.getAttribute('data-view');
    const s = store.schemes.find(x=>x.id===id);
    alert(`${s.title}\n\nOrganization: ${s.org}\nWindow: ${fmtDate(s.openDate)} ‚Äì ${fmtDate(s.closeDate)}\nStatus: ${computedStatus(s)}\n\n${s.description||''}`);
  }));
  $$("#announcements [data-apply]").forEach(b=>b.addEventListener('click',()=>{
    const id = b.getAttribute('data-apply');
    el.schemeSelect.value = id;
    document.querySelector('[data-tab="apply"]').click();
    el.schemeSelect.scrollIntoView({behavior:'smooth', block:'center'});
  }));
  $$("#announcements [data-edit]").forEach(b=>b.addEventListener('click',()=>{
    const id = b.getAttribute('data-edit');
    const s = store.schemes.find(x=>x.id===id);
    openSchemeModal(s);
  }));
  $$("#announcements [data-del]").forEach(b=>b.addEventListener('click',()=>{
    const id = b.getAttribute('data-del');
    if (!confirm("Delete this scheme?")) return;
    store.schemes = store.schemes.filter(x=>x.id!==id);
    refresh();
  }));
}

// Filters
el.searchInput.addEventListener('input', renderSchemes);
el.statusFilter.addEventListener('change', renderSchemes);

// Apply form
function refreshSchemeSelect(){
  const openList = store.schemes.map(s=>({...s, statusComputed:computedStatus(s)})).filter(s=>s.statusComputed==='open');
  el.schemeSelect.innerHTML = openList.map(s=>`<option value="${s.id}">${s.title}</option>`).join('') || '<option disabled>No open scheme</option>';
}
el.clearFormBtn.addEventListener('click',()=>el.applyForm.reset());

el.applyForm.addEventListener('submit',(e)=>{
  e.preventDefault();
  const v = Object.fromEntries(new FormData(el.applyForm).entries());
  if (!v.schemeId){ alert("Please choose a scheme"); return; }
  const app = {
    id: crypto.randomUUID(),
    name: (v.name||"").trim(),
    nid: (v.nid||"").trim(),
    phone: (v.phone||"").trim(),
    location: (v.location||'').trim(),
    farmType: v.farmType,
    schemeId: v.schemeId,
    notes: (v.notes||'').trim(),
    status: "submitted",
    timeline: [{ key:"submitted", label:"Submitted", at: Date.now() }],
    createdAt: Date.now(),
  };
  const arr = store.apps; arr.push(app); store.apps = arr;
  e.target.reset();
  refresh();
  alert("Application submitted!");
});

function setAppStatus(id,next){
  const apps = store.apps;
  const a = apps.find(x=>x.id===id);
  if (!a) return;
  a.status = next;
  const labels={submitted:"Submitted", review:"Under Review", approved:"Approved", rejected:"Rejected"};
  a.timeline.push({ key: next, label: labels[next]||next, at: Date.now() });
  store.apps = apps;
  refresh();
}

function renderApps(){
  const idx = Object.fromEntries(store.schemes.map(s=>[s.id,s]));
  const order = ["submitted","review","approved"];
  el.applicationsList.innerHTML = store.apps.slice().reverse().map(a=>{
    const s = idx[a.schemeId];
    const time = new Date(a.createdAt).toLocaleString('en-US');
    const rejected = a.status==='rejected';
    const stepsHtml = order.map(k=>{
      const active = a.timeline.some(t=>t.key===k);
      const label = ({submitted:"Submitted", review:"Under Review", approved:"Approved"})[k];
      return `<div class="flex items-center gap-2 text-xs ${active?'text-emerald-700':''}">
        <span class="w-2 h-2 rounded-full ${active?'bg-emerald-500':'bg-slate-300'}"></span>
        <span>${label}</span>
      </div>`;
    }).join('');
    return `<div class="rounded-2xl border border-emerald-200 bg-white p-4">
      <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-2">
        <div>
          <div class="text-sm text-slate-500">${time}</div>
          <div class="font-semibold">${a.name} ‚Äî <span class="text-slate-600">${a.nid}</span></div>
          <div class="text-sm text-slate-600">Scheme: <span class="font-medium">${s ? s.title : "Deleted scheme"}</span></div>
        </div>
        <div class="flex items-center gap-2">
          <span class="badge ${rejected?'badge-closed': a.status==='approved'?'badge-open':'badge-open'}">${rejected?'Rejected':a.status}</span>
          <button class="admin-only px-3 py-1.5 text-sm rounded-xl bg-slate-900 text-white hover:bg-slate-800" data-advance="${a.id}">Advance Status</button>
          <button class="admin-only px-3 py-1.5 text-sm rounded-xl border border-rose-200 text-rose-600 hover:bg-rose-50" data-reject="${a.id}">Reject</button>
          <button class="admin-only px-3 py-1.5 text-sm rounded-xl border border-slate-200 hover:bg-slate-50" data-delete-app="${a.id}">Delete</button>
        </div>
      </div>
      <div class="mt-3 flex items-center gap-4 flex-wrap">${stepsHtml} ${rejected?'<div class="flex items-center gap-2 text-xs text-rose-700"><span class="w-2 h-2 rounded-full bg-rose-500"></span><span>Rejected</span></div>':''}</div>
      ${a.notes ? `<p class="mt-2 text-sm text-slate-700"><span class="font-medium">Note:</span> ${a.notes}</p>` : ""}
    </div>`;
  }).join('');

  // admin actions
  $$("#applicationsList [data-advance]").forEach(b=>b.addEventListener('click',()=>{
    const id=b.getAttribute('data-advance');
    const app = store.apps.find(x=>x.id===id);
    const seq=["submitted","review","approved"];
    const i=seq.indexOf(app.status);
    if (i<seq.length-1) setAppStatus(id, seq[i+1]); else alert("Already approved.");
  }));
  $$("#applicationsList [data-reject]").forEach(b=>b.addEventListener('click',()=>{
    const id=b.getAttribute('data-reject');
    if (!confirm("Reject this application?")) return;
    setAppStatus(id, "rejected");
  }));
  $$("#applicationsList [data-delete-app]").forEach(b=>b.addEventListener('click',()=>{
    const id=b.getAttribute('data-delete-app');
    if (!confirm("Delete this application?")) return;
    store.apps = store.apps.filter(x=>x.id!==id);
    refresh();
  }));
}

// Export/Import
el.exportBtn.addEventListener('click',()=>{
  const data={ schemes:store.schemes, applications:store.apps, exportedAt:new Date().toISOString() };
  const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='subsidy-backup.json'; a.click();
  URL.revokeObjectURL(url);
});
el.importFile.addEventListener('change',(e)=>{
  const file=e.target.files[0]; if(!file) return;
  const reader=new FileReader();
  reader.onload=()=>{
    try{
      const data=JSON.parse(reader.result);
      if (Array.isArray(data.schemes)) store.schemes=data.schemes;
      if (Array.isArray(data.applications)) store.apps=data.applications;
      refresh();
      alert("Import complete");
    }catch(err){ alert("Invalid file"); }
  };
  reader.readAsText(file);
});

function refresh(){
  renderSchemes();
  refreshSchemeSelect();
  renderApps();
}
document.addEventListener('DOMContentLoaded',()=>{
  const y = document.getElementById("year"); if (y) y.textContent = new Date().getFullYear();
  refresh();
});
  </script>
</body>
</html>
